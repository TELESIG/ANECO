% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/soundclassifier_fit.R
\name{soundclassifier_fit}
\alias{soundclassifier_fit}
\title{Fit a Random Forest classifier to detect rain-dominated minutes}
\usage{
soundclassifier_fit(ref, ind, p = 0.8, nmax = NULL, classes = "All")
}
\arguments{
\item{ref}{A data.frame with labeled events. Must contain at least the columns
\code{File}, \code{Category}, \code{Start}, and \code{End}.
\describe{
  \item{File}{Audio file name (with extension). If the extension is missing,
    \code{.wav} is appended.}
  \item{Category}{Class label for the event. At minimum, should include
    \code{"Rain"} and at least one non-rain class (e.g., \code{"Clean"}).}
  \item{Start}{Event start time in minutes.}
  \item{End}{Event end time in minutes. \strong{Exclusive} upper bound.}
}}

\item{ind}{A data.frame of acoustic indices produced by
\code{\link[ANECO]{acoustic_indices}} with \code{noise.ind = TRUE}. It must contain
at least \code{Name} (file identifier) and \code{Minute} (minute index), plus the
indices used by this function (see \strong{Details}).}

\item{p}{Numeric in (0, 1]. Proportion of samples used for training. The remainder
is used as a hold-out test set. Default is \code{0.80}.}

\item{nmax}{Numeric, \code{"even"}, or \code{NULL}. Controls the maximum number of
samples per class used to fit the model:
\describe{
  \item{\code{NULL}}{No truncation; all available samples are used.}
  \item{\code{"even"}}{Caps all classes to the size of the least frequent class.}
  \item{numeric}{Caps each class to at most \code{nmax} randomly sampled rows.}
}}

\item{classes}{Character. Either \code{"All"} (default) to use all categories in
\code{ref}, or a character vector of class names to keep (e.g.,
\code{c("Clean","Rain")}).}
}
\value{
A list with components:
\describe{
  \item{model}{A fitted \pkg{caret} model object (Random Forest).}
  \item{info}{A table with the number of training samples per class.}
  \item{testdata}{Hold-out dataset not used for training.}
}
}
\description{
Trains a supervised classifier (Random Forest via \pkg{caret}) to identify
1-minute segments dominated by rain (\code{"Rain"}) using (1) a table of labeled
time intervals and (2) a table of acoustic indices computed with
\code{\link[ANECO]{acoustic_indices}} (with \code{noise.ind = TRUE}).
}
\details{
Although this function can be used in a multiclass setting (e.g., including
\code{"Cicada"} or other labels), the predictor set and intended use are optimized
for rain detection and performance on other noise sources may vary.


\strong{Rain definition.} \code{"Rain"} refers to minutes dominated by rain such
that other sounds are substantially masked. Because the boundary between light and
heavy rain is gradual, labels should reflect whether rain is sufficiently strong
to impair biological signal interpretation; when uncertain, labeling as
\code{"Rain"} is often preferable for conservative filtering.

\strong{Minute expansion rule (exclusive end).} Each labeled interval is expanded
to minute-level labels using the half-open interval \code{[Start, End)} at a
1-minute resolution. For example, \code{Start = 2} and \code{End = 5} will label
minutes 2, 3, and 4 (minute 5 is not included).

\strong{Predictors.} This function uses a fixed subset of indices designed for
noise/rain detection:
\code{msldB_bio}, \code{msldB_low}, \code{mdBGL}, \code{SpecIQR}, \code{SpecKurt},
\code{SpecSkew}, \code{SpecQ3}, \code{SpecCent}, \code{S2N_chi}, \code{dfreq},
\code{E01}, \code{E12}, \code{E23}, \code{E34}, \code{E45}, \code{E56}, \code{E67},
\code{E78}, \code{E89}, \code{E910}, \code{E1011}.

Model fitting uses \code{\link[caret]{train}} with method \code{"rf"} and
preprocessing \code{c("center","scale")}. Cross-validation progress is printed
during training (\code{verboseIter = TRUE}).
}
\examples{
\dontrun{
library(caret)
set.seed(123)

data("indices_data", package = "ANECO")
data("labeled_data", package = "ANECO")

# Binary rain detector (recommended use)
mod <- soundclassifier_fit(ref = labeled_data, ind = indices_data,
                           p = 0.8, nmax = "even",
                           classes = c("Clean","Rain"))

mod$model
table(mod$testdata$Category)

# Multiclass (user-provided additional labels); performance may vary
# mod2 <- soundclassifier_fit(ref = labeled_data, ind = indices_data,
#                             classes = c("Clean","Rain","Cicada"))
}

}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/acousticindices.R
\name{acoustic_indices}
\alias{acoustic_indices}
\title{Compute acoustic indices per minute with optional SPL calibration}
\usage{
acoustic_indices(
  dir = NULL,
  calibparam = "SM4",
  sel.ind = "all",
  exclude = "none",
  noise.ind = TRUE,
  bioband = c(1000, 11000),
  noiseband = c(0, 1000),
  channel = "left",
  prefix.format = "SSRR",
  wl = 512,
  ncores = NULL,
  save.file = TRUE,
  add.prefix = "XXXX",
  parallel = "files"
)
}
\arguments{
\item{dir}{Character. Path to a folder containing \code{.wav} audio files.}

\item{calibparam}{Calibration parameters used to convert amplitude measurements to absolute SPL. Either:
\itemize{
  \item a numeric vector \code{c(micsens, gain, vADC)}; or
  \item a character scalar selecting a recorder preset: \code{"SM4"},
    \code{"SMmini"}, or \code{"SM2+"}.
}
Where \code{micsens} is microphone sensitivity (dB re 1 V/\eqn{\mu}Pa), \code{gain} is recorder gain (dB), and \code{vADC} is the ADC zero-to-peak voltage (V). For background and recommended calibration practice, see Merchant et al.}

\item{sel.ind}{Character vector specifying which indices to compute. Use \code{"all"} (default) to compute all indices implemented in this function, or provide a character vector of index names (e.g., \code{c("ACI","ADI","msldB_bio")}). Available index codes can be inspected via \code{aneco_list_indices()} or using \code{ANECO::indices_catalog}. See \strong{Details}.}

\item{exclude}{Character vector of index names to exclude \emph{only when} \code{sel.ind = "all"}. Use \code{"none"} (default) to exclude nothing.}

\item{noise.ind}{Logical. If \code{TRUE}, ensures that the subset of indices used by  ANECO’s rain/noise classification workflow is included (e.g., \code{msldB_bio}, \code{msldB_low}, \code{mdBGL}, spectral statistics, \code{dfreq}, and band energies). Default is \code{TRUE}.}

\item{bioband}{Numeric length-2 vector giving the lower and upper frequency bounds (Hz) used to define the biophonic band for calibrated indices. Default is \code{c(1000, 11000)}.}

\item{noiseband}{Numeric length-2 vector giving the lower and upper frequency bounds (Hz) used to define the low-frequency band for calibrated indices. Default is \code{c(0, 1000)}.}

\item{channel}{Character. Channel to analyze when converting to mono.
Must be \code{"left"} or \code{"right"}. Default is \code{"left"}.}

\item{prefix.format}{Character string describing how site/recorder codes are embedded in the file name prefix. Uses \code{"S"} for site characters and \code{"R"} for recorder characters. For example, for files such as \code{BAJA08_20210523_050000.wav}, where \code{BAJA} is the site and \code{08} is the recorder ID, a suitable format is \code{"SSSSRR"}. Default is \code{"SSRR"}.}

\item{wl}{Numeric. FFT window length (in samples) used during spectral estimation for calibrated indices. Default is \code{512}.}

\item{ncores}{Integer. Number of workers used for parallel computation. If \code{NULL} (default), uses physical cores minus one (minimum 1). Availability can be checked with \code{parallel::detectCores(all.tests = TRUE, logical = FALSE)}.}

\item{save.file}{Logical. If \code{TRUE}, writes the resulting table to a CSV file in \code{dir}. The file name is built from the first \code{Code} value and a timestamp. Default is \code{TRUE}.}

\item{add.prefix}{Character. If a file name lacks a prefix (i.e., only contains the date/time fields), this value is prepended to allow parsing of \code{Site} and \code{RecorderID}. Default is \code{"XXXX"}.}

\item{parallel}{Character string controlling the parallelization level:
\itemize{
  \item \code{"files"}: process different audio files in parallel (each file processed sequentially by minute).
  \item \code{"minutes"}: process minutes within each file in parallel (files are processed sequentially).
}
Default is \code{"files"}.}
}
\value{
A data.frame with one row per analyzed minute. Includes identification columns
  (\code{Name}, \code{Code}, \code{Site}, \code{RecorderID}, \code{Date}, \code{Year}, \code{Month}, \code{Day}, \code{Hour}, \code{Minute}, \code{Duration}) and the requested index columns. Files/minutes that fail processing are omitted; the function may emit a warning listing file names that produced errors.
}
\description{
Computes a configurable set of acoustic indices for 1-minute segments from all \code{.wav} audio files found in \code{dir}. Indices can be computed from calibrated spectra (absolute SPL; via \code{\link[ANECO]{PAMCalib}}) and, optionally, a subset of commonly used soundscape indices from \pkg{seewave} and \pkg{soundecology} (computed without the SPL calibration step, using package defaults).
}
\details{
The output is a minute-level table including identification fields parsed from file names (using \code{prefix.format}) and the requested indices. The function supports parallelization either across audio files (\code{parallel = "files"}) or across minutes within each file (\code{parallel = "minutes"}), and can optionally write the results to a CSV file in \code{dir}.


\strong{Minute segmentation.} Each \code{.wav} file is read in 60-second blocks. The final segment is included only if its duration is at least 30 seconds.

\strong{Index selection.} \code{sel.ind} can be \code{"all"} or a vector of specific index names. Available index codes can be inspected via \code{aneco_list_indices()} or using \code{ANECO::indices_catalog}.  When \code{sel.ind = "all"}, \code{exclude} removes indices from the full set; when \code{exclude = "none"}, nothing is removed. When \code{noise.ind = TRUE}, a predefined subset required for rain/noise classification is added to the selection if missing.

\strong{Identification fields.} The output includes:
\code{Name} (file name), \code{Code} (prefix), \code{Site}, \code{RecorderID}, \code{Date}, \code{Year}, \code{Month}, \code{Day}, \code{Hour}, \code{Minute}, and \code{Duration} (seconds).
}
\examples{
\dontrun{
# Directory containing .wav files
path_folder_audios <- "C:/path/to/your/audio/files"

# Calibration parameters (SM4 preset)
calibration_parameters <- "SM4"

# Enable progress reporting (optional)
progressr::handlers(global = TRUE)

res <- acoustic_indices(
  dir = path_folder_audios,
  calibparam = calibration_parameters,
  sel.ind = c("ACI", "ADI", "msldB_bio"),
  exclude = "none",
  noise.ind = TRUE,
  parallel = "files"
)
}
}
\references{
\itemize{
  \item Buxton, R. T., et al. (2018). Efficacy of extracting indices from large-scale acoustic recordings to monitor biodiversity. \emph{Conservation Biology}.
  \item Merchant, N. D., et al. (2015). Measuring acoustic habitats. \emph{Methods in Ecology and Evolution}, 6(3), 257–265.
  \item Sueur, J., et al. (2016). \pkg{seewave}: Sound analysis and synthesis.
  \item Villanueva-Rivera, L. J. & Pijanowski, B. C. (2016). \pkg{soundecology}: Soundscape Ecology.
}
}
\seealso{
\code{\link[ANECO]{soundclassifier_fit}}, \code{\link[ANECO]{soundclassifier_predict}}
}
